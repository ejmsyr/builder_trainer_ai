# 🧠 Builder-Trainer Cognitive Loop

> A self-evolving, offline-capable coding agent that writes, tests, reflects, and improves through a feedback loop with an internal Trainer. All memory is persistent. No external training required.

## 📦 What's Inside

- 🧠 **Builder**: Generates and runs tasks using a local LLM (DeepSeek-Coder)
- 🧠 **Trainer**: Analyzes Builder memory, finds weaknesses, creates new challenges
- 🗂 **Memory System**: Stores tasks, scores, skill trees, reflections, failures
- ⚙️ **Shell Access**: Executes real code in a VM sandbox
- 🧠 **Scoring System**: Assigns points based on accuracy, speed, elegance, and difficulty
- 🔁 **Autonomous Loop**: Builder evolves itself via recursive tasks and reflection

## 🧰 Requirements

- **Docker** & **docker-compose**
- **LM Studio** running locally with:
  - Model: `deepseek-coder-7b-instruct.Q4_K_M.gguf`
  - HTTP server on: `http://localhost:1234/v1`

## 🐳 How to Run

```bash
git clone https://github.com/your-org/builder-trainer-ai.git
cd builder-trainer-ai

# Add your LM Studio environment info
cp .env.example .env

# Build and run the system
docker-compose up --build -d
```

## 🔄 System Architecture

The Builder-Trainer Cognitive Loop consists of several interconnected components:

### 1. Builder Agent

The Builder Agent is responsible for executing coding tasks. It uses the LLM to generate code based on task requirements, executes the code, and evaluates the results. The Builder Agent also reflects on its performance and learns from its mistakes.

Key components:
- `builder/run_project.py`: Executes tasks using LLM + shell
- `builder/reflect.py`: Summarizes task results, logs metrics

### 2. Trainer Agent

The Trainer Agent analyzes the Builder Agent's performance and generates new tasks to help it improve. It identifies skill gaps, style issues, and learning opportunities, and adjusts task difficulty based on the Builder Agent's progress.

Key components:
- `trainer/analyze_builder.py`: Loads full memory and profile
- `trainer/generate_task.py`: Creates task JSON with goal, difficulty, constraints
- `trainer/adjust_difficulty.py`: Difficulty curve tuning
- `trainer/strategy_manager.py`: Handles skill diversity, regression protection

### 3. Memory System

The Memory System stores all data related to the Builder-Trainer Cognitive Loop, including task history, code archives, performance metrics, and reflections.

Key components:
- `memory/core/*.json`: Profile, skill map, score log, reflections
- `memory/task_memory/`: All task metadata and outcomes
- `memory/code_archive/`: Saved versions of all generated code
- `memory/logs/`: Shell logs, system logs, runtime usage
- `memory/advanced/*.json`: Internal biases, learned concepts, motivation log

### 4. Core System

The core system orchestrates the interaction between the Builder Agent, Trainer Agent, and Memory System.

Key components:
- `loop.py`: Master orchestrator loop
- `memory_manager.py`: Handles all read/write to JSON memories
- `llm_interface.py`: Communicates with the LLM
- `score_engine.py`: Calculates and tracks scores

### 5. Execution Environment

The execution environment provides a safe way to run code generated by the Builder Agent.

Key components:
- `executor/run_cmd.py`: Subprocess shell executor
- `executor/run_code.py`: Executes generated Python or scripts

## 📊 Memory Structure

### Core Memory

- `builder_profile.json`: General profile of the Builder Agent
- `skill_map.json`: Map of skills and proficiency levels
- `score_log.json`: Log of task scores

### Task Memory

- `task_queue.json`: Queue of pending tasks
- `task_*.json`: Individual task definitions
- `reflection_*.json`: Reflections on completed tasks
- `summary_*.json`: Human-readable learning summaries

### Advanced Memory

- `trainer_log.json`: Log of Trainer Agent actions
- `current_difficulty.json`: Current difficulty settings
- `strategy_weights.json`: Weights for different training strategies
- `learned_concepts.json`: Concepts learned by the Builder Agent
- `builder_analysis_*.json`: Analysis of Builder Agent performance

## 🔧 CLI Usage

The system includes a command-line interface for interacting with the Builder-Trainer Cognitive Loop:

```bash
# Add a user task
python utils/cli.py add-task "Build a GUI downloader" --difficulty 0.7 --priority 1

# List recent tasks
python utils/cli.py list-tasks --count 10

# Get task details
python utils/cli.py get-task task_123456

# Get builder profile
python utils/cli.py get-profile

# Get skill map
python utils/cli.py get-skills

# Get performance trend
python utils/cli.py get-trend
```

## 🔄 Cognitive Loop Process

1. **Task Selection**: The system selects a task from the queue or generates a new one
2. **Code Generation**: The Builder Agent generates code to solve the task
3. **Code Execution**: The code is executed in a safe environment
4. **Evaluation**: The results are evaluated and scored
5. **Reflection**: The Builder Agent reflects on its performance
6. **Learning**: The Builder Agent updates its skills and knowledge
7. **Analysis**: The Trainer Agent analyzes the Builder Agent's performance
8. **Task Generation**: The Trainer Agent generates new tasks to help the Builder Agent improve

## 🧪 Testing

The system includes a comprehensive test suite:

```bash
# Run all tests
pytest

# Run specific test
pytest tests/test_memory.py

# Run tests with coverage
pytest --cov=.
```

## 📝 License

This project is licensed under the MIT License - see the LICENSE file for details.

## 🙏 Acknowledgements

- [DeepSeek-Coder](https://github.com/deepseek-ai/DeepSeek-Coder) for the LLM model
- [LM Studio](https://lmstudio.ai/) for the local LLM server

